<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뇌 건강 지킴이: AI 치매 진단 및 재활 가이드</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
        }
        /* Custom scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94A3B8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748B;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto p-4 md:p-8">

        <!-- Header Section -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-5xl font-bold text-blue-800 mb-2">뇌 건강 지킴이</h1>
            <p class="text-lg md:text-xl text-slate-600">AI 치매 진단 & 재활 가이드</p>
        </header>

        <!-- Main Content Grid -->
        <div class="space-y-12">

            <!-- AI Dementia Self-Check Section -->
            <section id="ai-diagnosis" class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                <div class="flex items-center mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                        <path d="M12 2a10 10 0 0 0-9.28 13.93C.96 17.5 1 22 1 22h22s0-4.5.28-6.07A10 10 0 0 0 12 2z"></path>
                    </svg>
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-700">AI 기반 자가 진단</h2>
                </div>
                <p class="text-sm md:text-base text-slate-500 mb-6">
                    이 테스트는 치매 위험도를 예측하는 참고용 도구입니다. 정확한 진단은 반드시 전문가와 상담하세요.
                </p>

                <div id="quiz-container" class="space-y-6">
                    <!-- Quiz content will be dynamically loaded here -->
                </div>
            </section>

            <!-- Understanding Dementia Section -->
            <section id="understanding" class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                <div class="flex items-center mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <line x1="10" y1="9" x2="8" y2="9"></line>
                    </svg>
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-700">치매에 대한 이해</h2>
                </div>

                <div class="prose max-w-none text-slate-700">
                    <h3 class="font-semibold text-xl mb-2">치매란 무엇인가요?</h3>
                    <p class="mb-4">
                        치매는 단순한 건망증을 넘어, 여러 가지 인지 기능이 손상되어 일상생활에 지장을 초래하는 복합적인 증후군입니다. 이는 특정 질병이 아닌, 다양한 원인에 의해 발생하는 증상들의 집합체입니다.
                    </p>

                    <h3 class="font-semibold text-xl mb-2">주요 원인과 종류</h3>
                    <p class="mb-4">
                        치매의 가장 흔한 원인은 알츠하이머병입니다. 이 외에도 뇌혈관 질환에 의한 혈관성 치매, 루이체 치매 등 다양한 종류가 있습니다. 각 원인에 따라 증상과 진행 속도에 차이가 있을 수 있습니다.
                    </p>

                    <h3 class="font-semibold text-xl mb-2">단계별 증상 변화</h3>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>초기:</strong> 최근 일에 대한 기억력 저하가 주로 나타나며, 물건을 자주 잃어버리거나 같은 질문을 반복하는 경향이 있습니다. 일상생활에는 큰 문제가 없는 경우가 많습니다.</li>
                        <li><strong>중기:</strong> 기억력 저하가 심해져 오래된 기억까지 손상될 수 있습니다. 길을 잃거나 시간, 장소에 대한 혼란을 겪기 시작하며, 성격 변화나 망상 등 행동 문제가 동반될 수 있습니다.</li>
                        <li><strong>말기:</strong> 대부분의 인지 기능이 소실되어 스스로 식사를 하거나 대소변을 가리는 등 기본적인 생활이 어려워집니다. 의사소통이 불가능해지고, 신체적인 도움 없이는 생활이 힘들어집니다.</li>
                    </ul>
                </div>
            </section>

            <!-- Rehabilitation & Care Section -->
            <section id="rehabilitation" class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                <div class="flex items-center mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3">
                        <path d="M19.143 14.857a2 2 0 0 1-2.829 0l-5.698-5.698a2 2 0 0 1 0-2.829l2.829-2.828a2 2 0 0 1 2.828 0l5.698 5.698a2 2 0 0 1 0 2.829z"></path>
                        <path d="M7.172 17.025L3 21l3.975-4.172"></path>
                    </svg>
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-700">재활 치료 및 관리</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Cognitive Rehabilitation Card -->
                    <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                        <div class="flex items-center mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#64748B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                                <path d="M12 2L2 7l10 5l10-5l-10-5z"></path>
                                <path d="M2 17l10 5l10-5"></path>
                                <path d="M2 12l10 5l10-5"></path>
                            </svg>
                            <h3 class="font-semibold text-lg text-slate-700">인지 재활 활동</h3>
                        </div>
                        <p class="text-slate-600 mb-4">기억력과 사고력 향상에 도움이 되는 활동들입니다.</p>
                        <ul class="list-disc list-inside text-slate-600 space-y-1">
                            <li>퍼즐 맞추기, 스도쿠</li>
                            <li>독서 및 글쓰기</li>
                            <li>새로운 취미 배우기</li>
                            <li>기억력 훈련 게임</li>
                        </ul>
                    </div>

                    <!-- Physical Rehabilitation Card -->
                    <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                        <div class="flex items-center mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#64748B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                                <path d="M18 12h-5m-5 0h5m0 0a2 2 0 1 1-2 2a2 2 0 0 1 2-2zm0 0l-5-5-5 5-5-5"></path>
                            </svg>
                            <h3 class="font-semibold text-lg text-slate-700">신체 재활 운동</h3>
                        </div>
                        <p class="text-slate-600 mb-4">신체 기능을 유지하고 치매 진행을 늦추는 데 효과적입니다.</p>
                        <ul class="list-disc list-inside text-slate-600 space-y-1">
                            <li>매일 가볍게 걷기</li>
                            <li>스트레칭 및 요가</li>
                            <li>균형 감각 훈련</li>
                            <li>간단한 근력 운동</li>
                        </ul>
                    </div>

                    <!-- Daily Care Tips Card -->
                    <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 md:col-span-2">
                        <div class="flex items-center mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#64748B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
                            </svg>
                            <h3 class="font-semibold text-lg text-slate-700">생활 속 관리 팁</h3>
                        </div>
                        <p class="text-slate-600 mb-4">환자와 보호자를 위한 실용적인 조언들입니다.</p>
                        <ul class="list-disc list-inside text-slate-600 space-y-1">
                            <li>규칙적인 생활 습관 유지</li>
                            <li>균형 잡힌 식단 섭취</li>
                            <li>안전한 주거 환경 조성</li>
                            <li>정서적 안정 제공</li>
                        </ul>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <script>
        // JavaScript for the interactive AI Dementia Self-Check
        document.addEventListener('DOMContentLoaded', () => {

            // Define the quiz questions and user answers array
            const questions = [
                { question: "오늘이 무슨 요일인지 기억나시나요?", options: ["예, 기억납니다.", "아니오, 잘 모르겠습니다."] },
                { question: "최근에 있었던 중요한 가족 행사를 기억하시나요?", options: ["예, 기억납니다.", "아니오, 잘 모르겠습니다."] },
                { question: "30초 동안 5가지 채소 이름을 말해보세요.", options: ["5가지 이상 말할 수 있습니다.", "3~4가지 말할 수 있습니다.", "1~2가지 말할 수 있습니다.", "전혀 말할 수 없습니다."] },
                { question: "새로 알게 된 사람의 이름을 기억하는 데 어려움이 있나요?", options: ["아니오, 어려움이 없습니다.", "예, 가끔 어려움이 있습니다.", "예, 자주 어려움이 있습니다."] },
                { question: "일상적으로 사용하던 물건을 엉뚱한 곳에 두는 경우가 있나요?", options: ["아니오, 그런 적 없습니다.", "예, 가끔 그런 적 있습니다.", "예, 자주 그런 적 있습니다."] },
                { question: "은행 업무나 복잡한 계산을 하는 데 어려움을 느끼시나요?", options: ["아니오, 어려움이 없습니다.", "예, 가끔 어려움이 있습니다.", "예, 자주 어려움이 있습니다."] },
                { question: "대화를 하다가 적절한 단어가 떠오르지 않아 대화가 끊기는 경우가 있나요?", options: ["아니오, 그런 적 없습니다.", "예, 가끔 그런 적 있습니다.", "예, 자주 그런 적 있습니다."] },
                { question: "날짜와 시간을 자주 혼동하시나요?", options: ["아니오, 혼동하지 않습니다.", "예, 가끔 혼동합니다.", "예, 자주 혼동합니다."] },
                { question: "새로운 기기(스마트폰, TV 리모컨 등) 사용법을 배우는 데 어려움이 있나요?", options: ["아니오, 어려움이 없습니다.", "예, 어려움이 있습니다."] },
                { question: "잘 아는 장소에서 길을 잃거나 헤매는 경우가 있나요?", options: ["아니오, 그런 적 없습니다.", "예, 가끔 그런 적 있습니다.", "예, 자주 그런 적 있습니다."] },
                { question: "옷을 입을 때 단추를 제대로 끼우거나 순서를 헷갈리는 경우가 있나요?", options: ["아니오, 그런 적 없습니다.", "예, 가끔 그런 적 있습니다.", "예, 자주 그런 적 있습니다."] },
                { question: "취미 활동이나 사회생활에 대한 관심이 줄었나요?", options: ["아니오, 그렇지 않습니다.", "예, 조금 줄었습니다.", "예, 많이 줄었습니다."] },
                { question: "평소보다 성격이 더 예민해지거나 감정 기복이 심해졌나요?", options: ["아니오, 그렇지 않습니다.", "예, 조금 그렇습니다.", "예, 많이 그렇습니다."] },
                { question: "최근 1년 동안 독서량이나 신문 읽는 횟수가 줄었나요?", options: ["아니오, 그렇지 않습니다.", "예, 줄었습니다."] },
                { question: "식사 시간이 불규칙해지거나 식사량을 조절하는 데 어려움이 있나요?", options: ["아니오, 그렇지 않습니다.", "예, 조금 그렇습니다.", "예, 많이 그렇습니다."] },
                { question: "주변 사람들의 이야기를 이해하거나 따라가는 데 어려움이 있나요?", options: ["아니오, 어려움이 없습니다.", "예, 가끔 어려움이 있습니다.", "예, 자주 어려움이 있습니다."] },
                { question: "물건을 살 때 계산을 틀리거나 잔돈을 잘못 받는 경우가 있나요?", options: ["아니오, 그런 적 없습니다.", "예, 가끔 그런 적 있습니다.", "예, 자주 그런 적 있습니다."] },
                { question: "새로운 장소에 갔을 때 길을 찾기 어렵다고 느끼나요?", options: ["아니오, 그렇지 않습니다.", "예, 가끔 그렇습니다.", "예, 자주 그렇습니다."] },
                { question: "자주 쓰는 물건의 이름이 갑자기 생각나지 않을 때가 있나요?", options: ["아니오, 그런 적 없습니다.", "예, 가끔 그런 적 있습니다.", "예, 자주 그런 적 있습니다."] },
                { question: "사람들과의 대화에서 주제를 따라가기 어렵다고 느끼나요?", options: ["아니오, 어렵지 않습니다.", "예, 가끔 어렵습니다.", "예, 자주 어렵습니다."] }
            ];

            let currentQuestionIndex = 0;
            const userAnswers = [];
            const quizContainer = document.getElementById('quiz-container');

            // Function to render the current question
            function renderQuestion() {
                if (currentQuestionIndex < questions.length) {
                    const q = questions[currentQuestionIndex];
                    quizContainer.innerHTML = `
                        <div class="bg-slate-100 p-6 rounded-lg border border-slate-200">
                            <p class="text-lg font-semibold mb-4 text-slate-700">질문 ${currentQuestionIndex + 1} / ${questions.length}</p>
                            <p class="text-xl md:text-2xl font-medium text-slate-800 mb-6">${q.question}</p>
                            <div class="space-y-3">
                                ${q.options.map((option, index) => `
                                    <button class="w-full text-left p-4 bg-white rounded-lg border border-slate-300 hover:bg-slate-200 transition-colors duration-200"
                                            data-index="${index}">
                                        ${option}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    // Add event listeners to the new buttons
                    quizContainer.querySelectorAll('button').forEach(button => {
                        button.addEventListener('click', handleAnswer);
                    });
                } else {
                    // All questions answered, show loading state and call AI
                    showLoadingAndAnalyze();
                }
            }

            // Function to handle the user's answer
            function handleAnswer(event) {
                const selectedIndex = parseInt(event.target.dataset.index);
                userAnswers.push({
                    question: questions[currentQuestionIndex].question,
                    answer: questions[currentQuestionIndex].options[selectedIndex]
                });
                currentQuestionIndex++;
                renderQuestion();
            }

            // Function to show loading state and initiate AI analysis
            async function showLoadingAndAnalyze() {
                quizContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center p-8">
                        <svg class="animate-spin h-10 w-10 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-4 text-lg text-slate-500">AI가 답변을 분석 중입니다...</p>
                    </div>
                `;

                // Create a detailed prompt from the user's answers
                const userPrompt = `사용자가 치매 자가 진단 퀴즈에 답변했습니다. 이 답변들을 분석하여 사용자의 뇌 건강 상태에 대한 종합적인 평가를 내려주세요. 답변은 세 가지 섹션으로 구성해 주세요:
- '진단 결과': 사용자의 뇌 건강 상태를 '정상', '경도 인지 저하 가능성', '치매 위험성 높음' 중 하나로 판단해 주세요.
- '분석 내용': 왜 그렇게 판단했는지, 답변에서 나타난 긍정적/부정적 요인들을 구체적으로 설명해 주세요.
- '권장 사항': 뇌 건강을 위해 일상생활에서 실천할 수 있는 구체적인 행동(예: 독서, 산책 등)을 권장해 주세요.
각 섹션은 명확하게 구분해 주세요. 사용자의 답변은 다음과 같습니다:
${userAnswers.map(ua => `- ${ua.question} 답변: ${ua.answer}`).join('\n')}`;

                // Call the Gemini API to get the AI analysis
                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: userPrompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    // Implement exponential backoff for retries
                    let response;
                    let retries = 0;
                    while (retries < 3) {
                        try {
                            response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });
                            if (response.status === 429) { // Too many requests
                                retries++;
                                await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                                continue;
                            }
                            if (!response.ok) {
                                throw new Error(`API call failed with status: ${response.status}`);
                            }
                            break;
                        } catch (error) {
                            retries++;
                            if (retries >= 3) {
                                throw error;
                            }
                            await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                        }
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const aiResponseText = result.candidates[0].content.parts[0].text;
                        showResults(aiResponseText);
                    } else {
                        showError("AI 분석 결과를 가져오는 데 실패했습니다.");
                    }
                } catch (error) {
                    showError("API 호출 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.");
                    console.error('API Error:', error);
                }
            }

            // Function to show the final results from AI
            function showResults(aiResponseText) {
                // Split the response into sections based on the predefined format
                const sections = aiResponseText.split('\n- ');
                let resultSection = '';
                let analysisSection = '';
                let recommendationSection = '';

                sections.forEach(section => {
                    if (section.startsWith('진단 결과')) {
                        resultSection = section.replace('진단 결과: ', '');
                    } else if (section.startsWith('분석 내용')) {
                        analysisSection = section.replace('분석 내용: ', '');
                    } else if (section.startsWith('권장 사항')) {
                        recommendationSection = section.replace('권장 사항: ', '');
                    }
                });

                let resultColor;
                if (resultSection.includes('정상')) {
                    resultColor = "text-green-600";
                } else if (resultSection.includes('경도')) {
                    resultColor = "text-yellow-600";
                } else {
                    resultColor = "text-red-600";
                }

                quizContainer.innerHTML = `
                    <div class="text-center p-8 bg-slate-100 rounded-lg border border-slate-200">
                        <h3 class="text-2xl font-bold mb-4 text-slate-800">진단 결과</h3>
                        <p class="text-lg font-extrabold ${resultColor}">${resultSection}</p>
                        <div class="text-left mt-6 space-y-4">
                            <div class="p-4 bg-white rounded-lg border border-slate-200">
                                <h4 class="font-semibold text-lg mb-2 text-slate-700">분석 내용</h4>
                                <p class="text-sm text-slate-600">${analysisSection}</p>
                            </div>
                            <div class="p-4 bg-white rounded-lg border border-slate-200">
                                <h4 class="font-semibold text-lg mb-2 text-slate-700">권장 사항</h4>
                                <p class="text-sm text-slate-600">${recommendationSection}</p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-500 mt-6">
                            이 결과는 참고용이며, 정확한 진단은 반드시 의사와 상담해야 합니다.
                        </p>
                        <button onclick="window.location.reload()" class="mt-6 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold shadow-md hover:bg-blue-700 transition-colors duration-200">
                            다시 테스트하기
                        </button>
                    </div>
                `;
            }

            // Function to show an error message
            function showError(message) {
                quizContainer.innerHTML = `
                    <div class="text-center p-8 bg-red-100 text-red-700 rounded-lg border border-red-300">
                        <p class="text-lg font-semibold mb-4">오류 발생</p>
                        <p>${message}</p>
                        <button onclick="window.location.reload()" class="mt-6 px-6 py-3 bg-red-600 text-white rounded-lg font-semibold shadow-md hover:bg-red-700 transition-colors duration-200">
                            다시 시도
                        </button>
                    </div>
                `;
            }

            // Start the quiz
            renderQuestion();
        });
    </script>

</body>
</html>
